<%content_for :head do%>
		<meta charset="utf-8">
	    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<%=javascript_include_tag "jquery-2.1.0"%>
		<%=javascript_include_tag "mui.min"%>
		<%=stylesheet_link_tag "wechat_front/mui.min"%>
		<%=stylesheet_link_tag "wechat_front/common"%>
		<%=stylesheet_link_tag "wechat_front/KaJuan2"%>
		<%=stylesheet_link_tag "wechat_front/KaJuan_New"%>
		<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	    <title>我的卡劵</title>
	    	    	<script type="text/javascript">
			wx.hideAllNonBaseMenuItem();

		 wx.config({
			      debug: false, 
						appId: '<%=params[:appid]%>', 
						timestamp:'<%=timestamp=Time.now.to_i%>' , 
						nonceStr: '<%=nonceStr=SecureRandom.uuid.tr('-', '')%>', 
						signature: '<%=signature(timestamp,nonceStr)%>',
						jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage'] 
		});
		wx.ready(function(){
		//    wx.hideOptionMenu();
		wx.showAllNonBaseMenuItem();
		wx.onMenuShareTimeline({
		      title: '<%=@sangna_config.per_user.name%>!', 
		        link: 'http://weixin.linkke.cn/wechat/wc_front/choose_technician?appid=<%=params[:appid]%>',
		        imgUrl: 'http://linkke.cn<%=@sangna_config.per_user.per_user_imgs.first.url.thumb.url%>',
		        success: function(res){
							
		        },
		        cancel: function(res){
				    }
			 });


			 wx.onMenuShareAppMessage({
				    title: '<%=@sangna_config.per_user.name%>!', 
					  desc: '', 
					  link: 'http://weixin.linkke.cn/wechat/wc_front/choose_technician?appid=<%=params[:appid]%>', 
						imgUrl: 'http://linkke.cn<%=@sangna_config.per_user.per_user_imgs.first.url.thumb.url%>',
						success: function () { 
						},
						cancel: function () { 
						}
			 });
		})

		$(function(){
			    <%if !@bind%>
			    	mui.toast('您善未绑定手机,三秒后跳转到绑定页面!')
			    	setTimeout(function(){
			    		window.location.href='phone_bind?appid=<%=params[:appid]%>';
			    	},3000)
			    <%end%>
		})
		function rule(id){
				window.location.href='card_rule?id='+id+"&appid=<%=params[:appid]%>";	
		}
	</script>

<%end%>
<%content_for :body do%>		
		<div class="mui-content">
			<div class="box_Choice">
				<button type="button" class="mui-btn mui-btn-outlined btn_Comment btn_Selected">评论代金券</button>
				<button type="button" class="mui-btn mui-btn-outlined btn_Scene ">现场代金券</button>
			</div>
			<!--评论代金券-->
			<div id="Comment_Vouchers">
			<%@cards.each do |card|%>
				<%if card.coupons_rule && card.status.in?([1,2])%>	
						<div class="box_coupons" onclick='rule(<%=card.id%>)'>
							<div class="Voucher_infor_left_Comment">
								<div class="Discount_num">￥<%=card.value%></div>
								<div class="box_line"></div>
								<div class="Voucher_type">评论代金券</div>
								
							</div>
							<div class="Voucher_infor_right">
							<%if @inscene%>
                				<%if card.status==1%>
                   					<img class="IMG_Voucher_status" src="/images/NoActivation.png" alt="" width="50px" />
                			 	<%elsif card.status==2%>
                    				<img class="IMG_Voucher_status" src="/images/Activation.png" alt="" width="50px" />
                			 	<%end%>
              				<%end%>

								<div class="box_infor">
									<div class="Project_name">适用于所有项目</div>
									<div class="Voucher_number"><%=card.number%></div>
									<div class="Use_Rule">使用规则</div>
								</div>
								<div class="Voucher_Validity">有效时间：<%=(card.created_at+card.coupons_rule.due_day.days).strftime('%Y年%m月%d日')%></div>
							</div>
						</div>
				<%end%>
			<%end%>
	
			</div>
			<div id="Scene_Vouchers">
			<%@cards.each do |card|%>
			   <%if !card.coupons_rule && card.status.in?([1,2])%>
				<div class="box_coupons" onclick='rule(<%=card.id%>)'>
					<div class="Voucher_infor_left_Scene">
						<div class="Discount_num">￥<%=card.value%></div>
						<div class="box_line"></div>
						<div class="Voucher_type">现场代金券</div>
						
					</div>
					<div class="Voucher_infor_right">
						<%if @inscene%>
                			<%if card.status==1%>
                   				<img class="IMG_Voucher_status" src="/images/NoActivation.png" alt="" width="50px" />
                			 <%elsif card.status==2%>
                    			<img class="IMG_Voucher_status" src="/images/Activation.png" alt="" width="50px" />
                			 <%end%>
              			<%end%>
						<div class="box_infor">
							<div class="Project_name"><%=card.ab_recommended_project.per_user_project.name%></div>
							<div class="Voucher_number"><%=card.number%></div>
							<div class="Use_Rule">使用规则</div>
						</div>
						<div class="Voucher_Validity">有效期:离场前</div>
					</div>
				</div>
				<%end%>
			<%end%>
			</div>
			
		</div>
		<!--弹窗---卡劵-->
			<div class="Popup_Voucher">
				<div class="Voucher_content">
					<span class="mui-icon mui-icon-closeempty"></span>
					<div class="Voucher_number2"><%=params[:num]%></div>
					<div class="box_img">
						<img src="/images/Voucher.png" alt="" />
					</div>
				</div>
			</div>
		
		<script type="text/javascript">
			function HidePopupVoucher(){
				$('.Popup_Voucher').hide();
			}
			$(function(){
				$('.Voucher_infor_left_Comment').css('width',120*194/206);
				$('.Voucher_infor_left_Scene').css('width',120*194/206);
				$('.Voucher_infor_right').css('width',$('.box_coupons').width()-120*194/206-5);
				//切换代金券
				$('.btn_Scene').click(function(){
					$('#Scene_Vouchers').show();
					$('#Comment_Vouchers').hide();
					$(this).addClass('btn_Selected');
					if($('.btn_Comment').hasClass('btn_Selected')){
						$('.btn_Comment').removeClass('btn_Selected')
					}
				})
				$('.btn_Comment').click(function(){
					$('#Scene_Vouchers').hide();
					$('#Comment_Vouchers').show();
					$(this).addClass('btn_Selected');
					if($('.btn_Scene').hasClass('btn_Selected')){
						$('.btn_Scene').removeClass('btn_Selected')
					}
				})
				<%if params[:prompt] == 'true'%>
				//代金券弹窗提示
				$('#Scene_Vouchers').show();
					$('#Comment_Vouchers').hide();
					$('.btn_Scene').addClass('btn_Selected');
					if($('.btn_Comment').hasClass('btn_Selected')){
						$('.btn_Comment').removeClass('btn_Selected')
					}
				$('.box_img>img').css('width', window.innerWidth*0.9);
				$('.Voucher_content>.mui-icon-closeempty').click(function(){
					$('.Popup_Voucher').hide();
//					setTimeout("HidePopupVoucher()",3000);
				})
				$('.Voucher_content').css('margin-top',(window.innerHeight-$('.box_img>img').height())/4);
				 setTimeout("HidePopupVoucher()",3000);
				 $('.Popup_Voucher').css('display','block');
				 <%end%>
			})
			
			
		</script>
<%end%>